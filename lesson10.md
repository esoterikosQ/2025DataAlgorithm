## 10. 통계이론에 기반한 시계열 데이터 분석 방법

### 10.1. 시계열 데이터란?

시계열 데이터는 시간적인 연속성을 가지고 수집한 데이터를 의미한다. 대표적인 시계열 데이터는 거시경제 관련 지표와 주식 가격 데이터가 있다. 데이터는 수집과 구조 생성 단계에서부터 분석가의 이론과 가설이 반영된다. 회귀분석을 수행하기 위해서 반응변수와 예측변수를 수집하면 반응변수에 영향을 줄 것이라고 기대되는 변수를 예측변수로 정하는 것은 이러한 현상을 반영한 것이다. 마찬가지로 시계열 데이터 역시 데이터의 구조와 의미가 "시간"이라는 개념과 매우 밀접할 것이라고 기대하고 생성하는 데이터이다. 시간과의 연관성은 크게 두 가지 측면에서 생각해볼 수 있는데, 첫째로는 "예측"이 의미를 가진다는 것이다. 시간과 데이터의 관계가 정립이 되는 경우, 이번 기간 혹은 다음 기간에 어떤 형태로 데이터가 나타날 것인가를 예측할 수 있다. 이 때문에 시계열 데이터 분석은 "어떻게 하면 다음 데이터를 예측할 수 있을 것인가?"에 초점을 두고 전개된다. 이 과정에서 시간과의 두 번째 연관성을 이용하는데, 바로 각 시점에 수집한 데이터 간에 관련성이 있을 것이라는 점이다. 기간에 따른 데이터의 변화와 연결 관계에 대한 기대가 없을 때에는 일반적으로 시계열 데이터를 생성하지 않는다. 인구주택총조사를 실시할 때에 각각의 세대별로 조사하는 시점은 다르지만 같은 해에 조사한 데이터라면 조사한 날짜를 별도로 명시하지 않는 것이 그 예이다. 과거에 수집한 데이터가 어떤 방식으로든 다음 시점에 수집하는 데이터와 연결관계가 있을 것이라는 이론적인 가정이나 묵시적인 기대를 반영한 것이 시계열 데이터이다.

---


### 10.1.1. 회귀모형을 통한 원리 이해 : 정상 시계열

그렇다면 시점 간 데이터의 연결을 어떤 방법으로 체계화할 수 있을까? 대표적인 이론적 시계열 데이터 분석 방법인 ARIMA 모형은 회귀모형과 유사하게 시점과 데이터의 연결을 구조화한다. 즉, 회귀모형에서는 반응변수의 변동분을 (체계적인 변동분) + (불규칙 오차)로 분해할 수 있는데, 이를 모형으로 나타내면 다음과 같다. 

```math
\boldsymbol y = \boldsymbol {X \beta} + \boldsymbol \epsilon \\
\boldsymbol \epsilon \sim N(0, \sigma^2)
```

회귀모형을 잘 구축하고 오류없이 적합했는지를 확인할 때에 체계적인 변동분에 해당하는 $\boldsymbol {X\beta}$가 아니라 예측값과 실제값의 차이를 바탕으로 계산한 $\boldsymbol \epsilon$의 분포를 이용하여 분석함으로써 확인한다. 즉, 이론적인 가정과 동일하게 잔차가 평균이 0이고 분산이 $\sigma^2$인 분포를 따르고 있는지를 확인함으로써 모형이 잘 적합되었는지를 확인한다.

이와 비슷하게 통계이론에 기반한 시계열 데이터 분석 역시의 변동분을 (시점과 체계적으로 연결된 변동분) + (불규칙 오차)로 나눈다. 시계열 데이터에서는 이러한 (불규칙 오차)를 백색 잡음(white noise) 또는 정상 시계열 데이터(stationary time-series data)라고 부른다. 정상성을 정의하는 요건은 세 가지가 있는데 (1) 시간에 의존하지 않는 평균, (2) 시간에 의존하지 않는 분산, (3) 시간에 의존하지 않고 일정한 공분산이다. 아래 그림은 세 가지 요건을 잘 보여주고 있다. [그림 출처](https://wandb.ai/iamleonie/A-Gentle-Introduction-to-Time-Series-Analysis-Forecasting/reports/A-gentle-introduction-to-time-series-analysis-forecasting--VmlldzoxMDg5NDMxMw)

![alt text](<Screenshot 2025-11-03 at 7.49.32 PM.png>)

가장 왼쪽 열에 있는 그림은 (1) 요건을 보여준다. 시계열 자료의 진동이 한 주기만큼 돌 때에 진동의 시점과 종점 사이 데이터의 평균을 노란색 점선으로 표시할 수 있는데, 어떤 주기에 평균을 측정하더라도 동일해야한다는 점을 보여준다.

두 번째 열에 있는 그림은 (2) 요건을 보여준다. 시계열 데이터의 분산은 평균으로부터 얼마나 떨어져있는가를 의미하는데, 그래프에서는 진동 주기에서 그래프가 가장 높은 지점과 가장 낮은 지점의 차이라고 개념적으로 이해할 수 있다. 이 주기가 시점과 무관하게 일정한 폭을 유지해야 한다.

세 번째 열에 있는 그림은 (3) 요건을 보여준다. 시계열 데이터의 공분산이란, 진동 그래프에서 진동 주기의 변동성으로 이해할 수 있는데, 각각의 진동이 가지는 진동주기가 시점과 무관하게 일정해야한다는 의미이다. 

따라서 회귀분석의 '정규분포를 따르는 오차'의 개념은 시계열 데이터에서 정상 시계열이라고 부르며, 시계열 그래프로 표현했을 때에 일정한 고점과 저점 사이에서 일정한 진동 주기를 가지고 움직이는 형태의 데이터를 뜻한다고 이해할 수 있다.

---

### 10.1.2. 규칙성의 종류

그렇다면 시계열 분석의 목적은 시점에 의존하는 체계적이고 규칙적인 요소를 어떻게 식별하고 어떻게 제거할 것인가가 된다. 시계열 데이터에서 발견할 수 있는 규칙성은 크게 추세(trend), 계절요인(seasonality), 순환(cycle)으로 나눌 수 있다. 추세는 데이터의 장기적인 방향성을 의미한다. 지속적으로 성장하는 경제권의 GDP를 측정했을 때에 장기적인 변동 방향을 추세로 이해할 수 있다. 계절요인은 일, 주, 월, 계절, 연도 등 달력상의 주기와 연결되어 변동하는 요인을 의미한다. 순환요인은 계절성과 무관하지만 고정되지 않은 특정 주기와 연결되어 움직이는 요인을 의미한다. 시장의 업황에 따라 기업의 매출 데이터가 변동한다고 할때에 해당 시장의 호황과 불황 사이클은 순환요인이라고 할 수 있다. 

그렇다면 시계열 데이터에서 규칙성을 가지는 요인을 어떻게 분리할까?

---

#### 10.1.3. 분해

시계열 데이터에서 비정상성 요인에 해당하는 추세, 계절, 순환 요인을 다양한 방법들이 존재한다. 이러한 분석 기법을 분해(decomposition)라고 한다.

분해 기법은 이동평균을 이용한 평활화 방법을 응용한 이동평균법, 회귀모형이나 확률모형에 적합한 후 특정 요인을 제거하는 모형접근법, 주파수 분석을 통해 체계적 요인을 분리해내는 주파수 분해법 등이 있다. 

분해 기법의 공통적인 특징은 ARIMA 모형을 이용한 분석으로 제거할 수 없는 체계적인 변동 요인을 식별하는 기법이라는 점이다. 시계열 데이터 분석 기법을 공부하면 항상 후반부에 나오기도 하면서, 이론적 기반이 복잡하고 전문적인 분야가 아닌 이상 활용도가 떨어지기 때문에 선후관계에 혼동을 느낄 수 있지만, 분석 체계상 시계열 데이터를 ARIMA 모형에 적합하기 전에 정상 시계열로 변환하기 위해 분해를 거치는 것이 순서이다.

---

#### 10.1.4. 차분

차분이란 현재 시점의 자료에서 과거 인접 시점의 자료를 차감하는 것을 의미한다. 시계열 $Y_t$의 d차 차분은 다음과 같이 표현할 수 있다.

```math
\Delta Y_d = Y_t - Y_{t-d}
```

차분을 이용하면 고정된 주기의 비정상 요인을 손쉽게 제거할 수 있다. 예를 들어, 계절에 따라 주기적으로 나타나는 변동 요인을 월별자료에서 제거하기 위해서는 3차 차분 데이터를 이용한다. 연간 주기적으로 나타나는 변동 요인을 월별자료에서 제거하기 위해서는 12차 차분 데이터를 이용한다.

이상을 통해 시계열 데이터의 기본적인 개념과 시계열 데이터 분석을 이해하는 데에 필요한 기본적인 사항들을 살펴봤다. 시계열 데이터 분석 단계의 핵심은 시계열 데이터를 정상 시계열로 변환하는 것이다. 이 과정에서 다양한 종류의 규칙성을 제거하는 방법들이 있는데, 고급 분석 사례에서는 일반적으로 '분해'라고 통칭하는 다양한 기법을 적용하여 체계적으로 비정상 요인을 분리한다. 좀 더 간단한 기법인 차분은 뒤이어 설명할 ARIMA 모형에서 비정상 요인을 제거하는 핵심 기법으로 활용한다.

> 참고자료 : 파이썬 노트북 10.1

---

### 10.2. ARIMA 모형

ARIMA 모형은 시계열 데이터를 d차 차분(integrated)함으로써 ARMA 모형이 되는 분석 모형이다. 즉, 차분을 통해 비정상 요인을 모두 제거하면 정상 시계열 데이터로 변환이 되는데, 이렇게 변환한 데이터의 본질을 설명할 수 있는 자기회귀의 정도와 오차 간의 상관이 어떤 방식으로 결합되어있는지를 밝히는 분석 방법이다. ARIMA를 

#### 10.2.1. AR모형

자기회귀(autoregress) 모형이란, 시점 간의 시계열 데이터가 체계적으로 연관되어 있다는 가설을 담은 것으로, 다음과 같이 표현할 수 있다.

```math
Y_t = \phi_0 + \sum_{i=1}^p \phi_i Y_{t-i} + \epsilon_t
```

즉, 현 시점의 데이터는 과거 p개 시점의 데이터의 선형 결합으로 표현할 수 있다. AR 모형이 안정성을 가지기 위한 조건은 자기회귀계수 $\phi_i$가 단위근 내에 존재해야 한다. 즉, 1차 AR 모형에서는 $|\phi| < 1$, 2차 모형에서는 $1 - \phi_1 z - \phi_2 z^2$의 근이 복소평면에서 반지름이 1인 원의 외부에 위치해야 한다. (자세한 내용은 주파수 분석의 이론적 기반인 푸리에 분석과 연결되기 때문에 여기서는 생략합니다.) 

AR 모형이 안정적이라는 의미는, AR 모형에 전체 데이터를 적합했을 때에 발산하지 않고 안정적인 범위 내에서 분산이 유지되고, 데이터 전체의 확률적인 요인을 모형을 잘 설명할 수 있다는 의미가 된다. 이 경우, 잔차항 $\epsilon_i$는 백색잡음의 형태를 가진다. (이러한 특성을 이용하여 AR 모형의 적합성을 검정하는 검정기법이 디키-풀러 검정입니다.)

p차에서 AR 모형이 안정적인지를 확인하기 위해서 가장 널리 사용하는 분석 방법은 자기상관계수와 부분자기상관계수를 이용하는 방법이다. 안정성 조건을 자기상관계수와 부분자기상관계수에 대입했을 때에 나타나는 변화를 시각화에 응용한 기법인데, 안정성 조건을 만족하는 경우 자기상관계수는 p차까지 지수적으로 감소하다가 p차 이후에 0이 되고, 부분자기상관계수는 p차까지는 값을 가지지만 후 p차 이후에 0이 된다(절단면 발생). 이를 그래프를 통해 확인하는 방법이다.

> 자기상관계수 : t기와 t-p기의 데이터 간 상관관계를 나타내는 계수  
> 부분자기상관계수 : t기와 t-p기의 데이터 간 상관관계를 두 데이터 사이의 다른 데이터의 영향력을 제거한 후 계산한 상관계수

---

#### 10.2.2. MA모형

이동평균(moving average) 모형이란, 시계열 데이터의 현재 상태를 과거의 충격(오차)의 선형결합으로 이해하는 모형이다. 이를 모형으로 표현하면 다음과 같다.

```math
Y_t = \theta_0 + \sum_{i = 1}^q \theta_i \epsilon_{t-i} + \epsilon_t
```

과거 시점에 발생하는 충격을 체계적으로 설명할 수 없는 요인인 오차로 이해할 때에 과거 시점의 데이터 전체가 아니라 비체계요인이 일정한 계수를 통해 현재 시점의 데이터에 영향을 미치고 있다고 가정하는 모형이다. 따라서 MA(q) 모형이 이론에 맞게 적합되는 경우 현재 시점의 데이터를 과거의 충격 요인을 이용하여 체계적으로 설명할 수 있게 되는데, 이를 가역성(invertability)이라고 한다. MA(q) 모형이 가역성을 가지기 위한 조건은 $\theta_i$를 계수로 하는 복소평면 상 다항식의 해가 단위근 바깥에 있어야 한다. 

> MA 모형과 AR 모형은 수학적으로 연결되어 있는데, AR 모형이 안정성을 가지는 경우 t기의 데이터를 무한시점의 오차의 선형결합으로 표현할 수 있다. (MA($\infty$)) 반대로, MA 모형이 가역성을 가지는 경우 t기의 오차를 무한시점의 데이터의 선형 결합으로 표현할 수 있다. (AR($\infty$))

가역성 조건을 만족하는 경우 자기상관계수는 q차까지 값을 가지나 q차 이후에 0이 되고(절단면 발생), 부분자기상관계수는 q차까지 지수적으로 감소하다가 q차 이후에 0이 된다.

---

#### 10.2.3. ARMA 모형

AR과 MA 중 한 가지 모형만을 선택해서 안정성 또는 가역성 조건을 만족하는 차수를 탐색하기 위해서는 차수가 지나치게 커지고 연산량이 많아지는 문제가 발생한다. 이를 보완하기 위해 AR과 MA를 동시에 이용하는 시계열 모형을 작성하는데, 이를 자기회귀이동평균(autoregressive moving average) 모형이라고 부른다. 이를 모형으로 표현하면 다음과 같다.

```math
Y_t = \phi_0 + \sum_{i = 1}^p \phi_i Y_{t-i} + \sum_{j=1}^q \theta_j \epsilon_{t-j} + \epsilon_t
```

ARMA 모형은 AR이나 MA와 달리 자기회귀계수와 부분자기회귀계수가 복합적으로 변동하기 때문에 이를 이용하여 적정한 p와 q를 탐색하기는 어렵다.(정확하게는 자기상관계수는 q-p차 이후, 부분자기상관계수는 p-q차 이후부터 소멸합니다.) 그래서 실제로는 데이터셋으로부터 적절한 AR모형의 p와 MA 모형의 q를 탐색한 후 AIC와 같은 모형 선택 기준을 이용하여 최적의 ARMA 모형을 선택하는 방법을 이용한다. 수리적으로는 안정성과 가역성을 가지기 위해서는 $\phi_i$와 $\theta_j$가 모두 단위근 조건을 만족해야 한다.

---

#### 10.2.4. 차분

확률보행(random walk, 임의보행이라고도 합니다.)모형이란, 시계열 데이터에서 이번 시점의 데이터는 직전 시점의 데이터에 예측 불가능한 오차값을 더한 크기에서 결정된다는 이론이다. 이론의 직관적인 의미는 충격 자체가 예측이 불가능하고 예측이 가능한 수준은 직전 시점의 수준이라는 점에 있으나, 이론 자체가 가지는 고유한 함의점은 '예측 불가능성'에 맞춰져있다. ARIMA 모형에서는 이러한 이론을 역으로 이용하여 정상 시계열을 추출하는 데에 활용한다.

```math
Y_t = Y_{t-1} + \epsilon_t
```

위와 같은 시계열 데이터의 구조로부터 다음과 같은 정상 시계열 추출이 가능하다.

```math
\epsilon_t = Y_t - Y_{t-1} \tag{1}
```

즉, 예측이 불가능한 오차가 정상 시계열이므로 t기와 (t-1)기의 차이를 이용하여 비정상 시계열을 정상 시계열로 전환할 수 있다. 

ARMA 모형은 정상 시계열이 담고 있는 주기와 분산의 성질을 이용하여 정상 시계열을 구조화하는 것을 목적으로 한다. 그런데 확률보행이론에 따르면 시계열 데이터에는 구조적인 비정상 요인이 존재한다. 확률보행이론의 가설은 AR(1) 모형과 일치하는 구조이지만, 이는 $\phi = 1$인 구조로 전기의 변동분이 그대로 다음 시점으로 누적되므로 안정성이 없는 모형이 된다. 안정성이 없는 시계열 데이터는 추세적으로 증가 또는 감소하는 형태로 변화하기 때문에 ARMA 모형에 부적절한 형태이다. 

이러한 구조적인 불안정 요인을 한번에 제거하는 방법이 차분이다. 식(1)의 성질을 이용하여 시계열 데이터를 일정 시점에 대해 차분함으로써 ARMA 모형에 적합한 데이터를 만들 수 있는데 이러한 모형을 ARIMA 모형이라고 한다. 차분은 식(1)과 같은 1차 차분으로 정상 데이터로 변환하는 경우가 대부분이지만, 다음과 같은 2회 차분 또는 다회 차분을 진행하기도 한다.

```math
\begin{aligned}
\Delta^2Y_t &= \Delta(\Delta Y_t) = \Delta (Y_t - Y_{t-1}) \\

&= (Y_t - Y_{t-1}) - (Y_{t-1} - Y_{t-2}) \\

&= Y_t - 2Y_{t-1} + Y_{t-2}

\end{aligned}
```

실제 데이터를 적합했을 때에 2회 차분으로도 정상성이 확인되지 않는 경우가 있는데, 이런 경우에도 ARIMA 모형 적합을 위해 3회 이상의 차분을 진행하는 것보다는 p(AR의 차수)나 q(MA의 차수)를 조정하여 정상성을 확보하는 방식으로 분석을 진행한다.

---

#### 10.2.4. 한계

확률론에 입각한 시계열 데이터 분석을 위해서는 [10.1.3.](#1013-분해)에서 언급한 것처럼 비정상 시계열에서 비정상 요인을 제거한 후 ARMA 모형에 적합하여 분석하는 순서대로 시계열 데이터 분석을 진행한다. ARIMA는 비정상 요인을 제거하기 위해 이론적 기반을 갖추었으면서도 아주 간단한 방법을 이용한다. 하지만, 확률보행이론은 시계열 데이터에서 예측 가능한 부분을 설명하는 이론이 아니기 때문에 제거한 비정상 요인이 어떤 이유에서 제거되었는지를 설명해주지 못한다. 단순히 비정상 요인을 제거한다는 점에만 초점이 맞춰져있는 것이다.

또다른 한계는 단일한 차분으로 제거될 수 없는 비정상 요인이 명백하다는 점이다. 추세 요인이나 계절 요인은 명확한 가설이나 개략적인 데이터상 근거가 있는 경우 특정 차수의 차분을 통해 제거가 가능하지만 순환 요인은 주기가 명확하지 않고 일정하지도 않기 때문에 고정적인 차수의 차분을 통해 제거가 불가능하다. 차분은 고정된 모수를 적용하여 이루어지기 때문에 차분의 주기와 순환 요인의 주기가 맞지 않으면 제거가 불가능하고, 1회 순환의 주기가 맞는다고 하더라도 2회 순환의 주기가 맞지 않으면 제거가 되지 않는다. 

또한, 정확한 ARIMA 모형 적합을 위해서는 p(AR의 차원), q(MA의 차원), d(차분의 차원)의 값을 정확하게 찾는 것이 중요하다. 하지만 앞서 서술한 것과 같이 ARMA 모형에서 p, q의 값을 수리적으로 명확하게 찾을 수 있는 기준이 없다. 이 때문에 통상 d차 차분을 수행한 상태에서 AR의 차원 p를 찾고 MA의 차원 q를 찾은 후 정상성을 만족하는지를 검정하는 방법으로 모형을 적합하는데, 이 과정이 매우 모호하고 직관에 의존하기도 하고, 또한 일반적으로 다수의 모형이 선택되기 때문에 어느 모형이 가장 우수한 모형인지 판단할 수 있는 방법이 확고하게 존재하지 않는다. (AIC와 같은 외생적 기준을 적용하기도 합니다.) 

마지막으로, 최적의 ARIMA 모형을 찾았을 때에 다음 시계열 데이터를 예측했을 때에 정확도가 매우 낮은 경험적인 특성을 가진다. 이러한 특성은 예측의 주기가 길어질 때에 급격하게 낮아진다. 시계열 데이터 분석의 가장 중요한 목적이 다음 시점의 데이터 예측이라는 점을 감안했을 때에 이러한 특성은 매우 치명적인 약점이라고 할 수 있다.

> 참고자료 : 파이썬 노트북 10.2

---

### 10.3. 맺음말

그럼에도 확률론에 입각한 시계열 데이터 분석은 여전히 시계열 데이터 분석시에 거의 항상 빼놓지 않고 적용하는 모형이며, 신경망 계열의 분석을 진행할 때에 비교할 수 있는 베이스라인 역할을 하는 경우가 많다. 또한, 신경망 계열의 분석을 통해 알 수 없는 체계적이고 구조적인 분석이 가능하기 때문에 경제, 금융, 스포츠 데이터 분석에서는 여전히 활발하게 활용되는 방법이다. 이를 정확하게 활용하기 위해서는 안정 시계열 확보를 위한 처리 작업이 매우 중요하다는 것을 알 수 있다. 다음 시간에는 분해와 관련된 다양한 분석 방법을 알아보겠다.