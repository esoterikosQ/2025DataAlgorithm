## 11. 통계이론에 기반한 다양한 시계열분석 방법

이번 시간에는 설명변수와 반응변수가 공존하는 시계열 데이터를 분석하는 여러 가지 방법에 대해 설명한다. 기본적으로 설명변수와 반응변수의 관계를 분석하는 회귀모형 측면의 접근법이 존재한다. 각각의 시점별로 회귀모형을 적합한 후 차분구조와 잔차의 형태에 따라 모형을 수정하는 방식의 Praise-Winsten 방법(PW), 패널 데이터에 대해 변수 간의 상관구조를 반영하여 회귀모형을 수정하는 일반화 추정 방정식 모형(GEE)은 회귀모형을 잔차 간의 상관구조에 따라 변형한 분석 방법이다. 반면, 설명변수와 반응변수 간의 이론적인 인과관계보다 상호작용을 통한 향후 예측에 분석의 초점을 두는 경우에는 벡터자기회귀(VAR) 분석을 통해 다변량 시계열 데이터의 상호관계를 구조화할 수 있다. 한편, 복합적인 정상/비정상 요인이 혼재되어있는 경우가 많은 시계열 데이터의 규칙적인 성분을 분해하는 분석 방법 중 주파수 분해 방법에 대해서도 살펴본다.


### 11.1. 회귀분석의 수정 : Prais-Winsten Method

다변량 시계열 데이터를 회귀모형에 적합하면 각각의 시점에 대한 회귀모형은 다음과 같이 구조화할 수 있다. ($\boldsymbol X_t$는 ($1 \times p$) 차원의 벡터, $\boldsymbol \beta$는 ($p \times 1$)차원의 벡터)

```math
y_t = \boldsymbol {X_t \beta} + \eta_t \tag{1}
```

여기에서 시점 간에 p차 자기상관이 있다면 위 회귀모형의 오차항은 다음과 같이 풀어서 쓸 수 있다.

```math
\eta_t = \rho \eta_{t-p} + \epsilon_t \tag{2}
```

식(1)과 식(2)를 연립하면 다음과 같은 모형이 된다.

```math
y_t = \boldsymbol {X_t \beta} + \rho \eta_{t-p} + \epsilon_t \tag{3}
```

시계열의 경우 일반적인 선형모형과 달리 $\epsilon_t$가 무작위성을 가지지 않는다. 즉, 백색잡음의 경우에도 안정 시계열의 조건인 평균, 분산, 공분산에서 규칙성을 가지기 때문에 일반적인 선형회귀와 달리 식(3)을 그대로 회귀모형으로 사용할 수 없다. 이러한 시계열 데이터의 특수성을 회귀모형에 반영한 것이 PW 방법이다.

PW 방법은 그대로 회귀모형에 적합했을 때에 잔차에 규칙성이 생기는 문제를 해결하기 위해서 잔차의 이론적인 상관구조에 맞게 자기상관계수를 수치적으로 계산할 수 있는 알고리즘을 반복하는 분석 방법이다. 이를 통해서 **시계열 구조에 부합하면서 회귀모형의 근본적인 가정인 무작위 잔차가 반영된 회귀게수를 계산**하는 것이 목적이다.

PW 방법의 전개 순서는 다음과 같다.

(1) 시계열 데이터를 이용하여 회귀모형을 적합하면 식(1)과 같은 구조가 생성

(2) 시계열 데이터가 AR(p)의 구조를 가지고 있다고 가정할 때,(1)단계에서 생성된 잔차 $\eta_t$는 다음과 같은 형태를 가진다.

```math
\eta_t = \phi_1 \eta_{t-1} + \cdots + \phi_p \eta_{t-p} + \epsilon_t \tag{4}
```

위 모형에 (1)단계의 잔차를 적합하여 자기상관계수 벡터($\phi_1, \phi_2, \cdots, \phi_p$)를 추정한다.

(3) 설명변수, 반응변수, 상수항을 (2)단계에서 계산한 자기상관계수 벡터를 이용하여 준차분(quasi-diffrencce)한 값을 계산한다.

```math
y_t^* = y_t - \sum_{i=1}^p \phi_i y_{t-i} \\ \\

\boldsymbol {X_t^*} = \boldsymbol{X_t} - \sum_{i=1}^p \phi_i \boldsymbol {x_{t-i}} \\ \\

\boldsymbol {1_t^*} = \boldsymbol 1 - \sum_{i=1}^p \phi_i \\\\
```

이 때에 첫 시점의 관측치에 대해서는 상관계수 행렬의 촐레스키 분해값의 맨 앞 p행의 값을 가중치로 두어 계산한다. (여기에서 $\boldsymbol 1$은 1로 구성된 벡터를 의미합니다.)

(4) (3)단계에서 갱신된 값을 이용하여 회귀모형을 적합한 후 새로운 $\boldsymbol {\beta^*}$를 계산한다.


(5) (4)단계의 회귀모형 적합결과를 이용하여 잔차벡터 $\eta^*_t$를 갱신한다.

(6) $\Delta \boldsymbol \phi$, $\Delta \boldsymbol \beta$가 사전에 정해진 임계값 아래로 떨어지면 알고리즘을 중단한다.

위 알고리즘은 잔차 구조의 독립, 등분산성이 깨지는 경우에도 BLUE 추정치를 보장하는 일반화 최소 제곱(Generalized Least Square) 방법을 시계열 데이터에 적용한 것이다. 위 과정을 통해서 생성한 모형에 대해 일반적인 F검정, t검정을 통해 적합도와 유의성을 확인하는 절차는 일반적인 회귀모형 검증과 동일한다. PW방법으로 생성한 모형의 적합성을 확인하기 위해서는 잔차에 대한 융-박스 검정(Ljung-Box test)을 통해 자기상관이 잔존하지 않는지 확인하는 절차를 거쳐야 한다.

---

### 11.2. VAR(Vector Autoregressive)

#### 11.2.1. 원리

VAR 모형은 다변량 시계열 데이터에서 여러 개의 변수가 상호작용했을 때에 어떻게 변화하는지 양상을 밝히는 분석 방법이다. 회귀분석과 VAR의 차이는 회귀분석에서는 설명변수를 외생적($X \rightarrow y$)이라고 가정하는 반면, VAR은 모든 변수를 내생적($X \leftrightarrow y$)이라고 가정한다. 즉, 각각의 변수는 상호작용하며, 복수의 변수가 상호작용한 결과 미래의 데이터가 어떻게 변화하는지를 **예측**하는 것을 목표로 한다. 이런 측면에서 VAR 모형은 확률론 기반의 ARIMA 계열의 분석 방법과 동일한 목표를 가지고 있다고 할 수 있다.

고전적인 VAR 모형은 다음과 같이 전개한다.

두 개의 변수로 이루어진 벡터 시계열이 1차에 거쳐 상호 영향을 미친다고 가정하면, 두 벡터의 시계열 데이터 구조는 다음과 같이 표현할 수 있다.

```math
x_t = \mu_1 + \alpha_1 x_{t-1} + \beta_1 y_{t-1} + \epsilon_{1t} \\

y_t = \mu_2 + \alpha_2 x_{t-1} + \beta_2 y_{t-1} + \epsilon_{2t} 
```

위 식을 벡터 시계열 데이터 $\boldsymbol X_t$의 형식으로 다음과 같이 나타낼 수 있다. 

```math
\boldsymbol X_t = \boldsymbol \mu + \boldsymbol {A X_{t-1}} + \boldsymbol \epsilon_t \tag{5}
```

이때, $\boldsymbol X_t, \boldsymbol \mu, \boldsymbol X_{t-1}, \boldsymbol \epsilon_t$는 ($2 \times 1$)차원 벡터, $\boldsymbol A$는 ($2 \times 2$)차원의 행렬이다. 이러한 벡터 시계열 구조를 VAR(1) 구조라고 한다. 이 구조는 AR 모형뿐만 아니라 MA, ARMA 모형에도 동일하게 적용이 가능하다. 하지만 ARMA 모형의 경우 자기상관계수와 부분자기상관계수뿐만 아니라 교차상관계수까지 고려해야해서 적절한 차수를 선정하기가 어렵기 때문에 일반적으로는 AR 구조를 응용한 VAR 모형을 활용한다. 

일반적인 VAR(p)의 모형구조를 식(5)의 형식에 따라 표기하면 다음과 같다.

```math
\boldsymbol X_t = \boldsymbol \mu + \boldsymbol {A_1 X_{t-1}} + \cdots + \boldsymbol {A_p X_{t-p}} + \boldsymbol \epsilon_t
```

안정 시계열을 이루는 위 VAR 모형의 오차 벡터는 (1) 모든 오차항의 기댓값은 0이고, (2) 오차항 내부의 원소 간에는 상관관계가 존재할 수 있고, (3) 오차 벡터 간의 상관관계는 0이다.

위와 같은 오차항의 상관관계 속성이 존재함에도 VAR 모형의 모든 항은 ($\boldsymbol X_{t-1}, \cdots, \boldsymbol X_{t-p}$)의 동일한 입력 데이터를 가지기 때문에 GLS 방법이 아닌 OLS 방법을 통해서도 해를 구할 수 있는 특징을 가진다. 

---

#### 11.2.2. 차원의 문제

위에서 본 것과 같이 VAR이 의미를 가지기 위해서는 AR과 동일한 안정성을 가져야 한다. 이를 위해서 적절한 p를 선정해야 하는데, 변수의 수 k와 p에 따라 모형이 가지는 모수는 $kp +1$개가 된다. 이 때문에 변수의 수가 너무 많아지거나 차원이 너무 커지는 경우 데이터가 가지는 정보량이 모형에 비해 급격하게 줄어든다. 이는 다중회귀모형에서 차원이 커질수록 신뢰구간이 급격하게 줄어드는 차원의 저주와 본질적으로 동일한 문제이다. 반면, 이 문제를 피하기 위해 p가 너무 낮아져서 과소적합되면 잔차에 자기상관이 남게 되어 안정성 조건을 위반하게 된다. 이 때문에 적절한 p를 선택해야하는데, ARIMA 모형의 차수를 선택하는 것과 비슷한 방식으로 AIC나 BIC를 이용할 수 있다.

---

#### 11.2.3. 인과관계 검정

이렇게 적합한 VAR 모형은 동태적인 변수 간의 상호작용 양상만을 보여줄 뿐 해석에 관한 가이드를 제공해주지는 않는다. 이러한 문제를 보완하기 위해 인과관계를 분석할 수 있다. 기본적인 아이디어는 벡터 시계열 데이터의 구성요소 $y_t$에 $x$의 상관계수가 0인지 아닌지를 검정하는 것이다. 이를 그랜저 인과(Granger-cause)라고 한다. 인과관계 분석을 위해서는 $y$만을 이용한 모형과 $x$를 포함한 모형 간의 F 통계량이나 Wald 통계량을 이용한 적합도 검정 방법을 이용한다.

그 밖에도 일변수에 미치는 충격이 다른 변수에 미치는 충격반응분석, 여러 변수 간 상호작용이 있을 때에 어느 변수가 상대적으로 중요한 정도를 가지는지를 확인하는 예측오차 분산분해 기법 등을 통해 변수 간의 상호관계를 좀 더 자세하게 파악할 수 있다.

---

#### 11.2.4. SVAR

하지만, 이상의 분석 방법에도 VAR 모형이 가지는 명확한 한계는 변수 간의 인과관계가 모형에 내재되어있지 않다는 점이다. 즉, 모든 변수가 내생변수로서 취급되기 때문에 모형 자체에서 변수 간의 관계가 명확하게 드러나지 않는다. 이변수가 아닌 다변수 수준에서는 변수의 순서에 따라 관계가 달라지기도 하고, 인과관계 검정 역시 명칭과 달리 상호관계의 순위를 드러낼 뿐 진정한 의미의 인과관계를 밝힐 수 있는 방법도 아니다. 이러한 한계를 극복하기 위해서 발전한 분석 방법이 구조적 VAR 모형이다. 벡터 시계열에서 비정상 요인을 추출할 수 있는 VECM, 사전확률의 개념을 도입하여 차원의 저주 문제를 피할 수 있도록 모수의 구조를 단순화한 베이지안 VAR 등이 구조적 VAR 모형의 범주에 포함된다.

---

### 11.3. 주파수 분해

시계열 데이터 분석 방법으로서 주파수 분해란, 시계열 데이터의 구성요소를 저차원의 주파수의 결합으로 분해하는 분석 방법이다. 주파수 분해는 푸리에 분해와 오일러 공식을 이론적인 기반으로 한다.

#### 11.3.1. 푸리에 급수와 오일러 공식

푸리에 급수는 주기함수를 분해하는 원리에 관한 이론이다. 주기 t에 맞춰 반복하는 함수를 사인과 코사인 곡선의 선형 조합으로 분해할 수 있다는 이론이다.

```math
X(t) = \sum_{n = 0}^\infty (a_n \sin {n \omega t} + b_n \cos n \omega t) + c_0 \tag{6}
```

식(6)에서 $\omega = 2\pi/t$로 주파수의 단위이다. 

한편, 오일러의 공식은 자연상수의 거듭제곱을 삼각함수로 연결하는 식으로 아래와 같이 표현할 수 있다.

```math
e^{ix} = \cos x + i \sin x \tag{7}
```

(식(7)에서 $x = \pi$를 대입하면 $e^{i \pi} + 1 = 0$ 형태의 오일러의 항등식이 됩니다.)

식(7)을 식(6)에 대입하면 다음과 같은 복소지수 함수 형태로 정리할 수 있다.

```math
X(t) = \sum_{n = -\infty}^\infty \gamma_n e^{i n \omega t} \tag{8}
```

식(8)에서 $\gamma$는 $a_n, b_n$에 따라 결정되는 계수이다. 이상의 변환을 통해 주파수 분해의 문제를 두 개의 삼각함수에 관한 문제($(a_n, b_n), c_0$를 찾는 문제)에서 복소 평면이라는 단일 평면에서 해를 찾는 문제( $\boldsymbol \gamma$를 찾는 문제)로 간결화할 수 있다. 또, 미분이나 적분이 복잡한 삼각함수 대신 지수함수 형태로 주파수 분해 문제를 변환함으로써 대수적인 접근과 해석이 용이해진다. 

정리하자면 푸리에 급수와 오일러 공식에 따라 주기성을 가지는 모든 종류의 데이터를 분해할 수 있으며, 이러한 원리를 시계열 데이터에 활용한 분석 방법이 주파수 분해 방법이다.

---

#### 11.3.2. 주파수 분해 적용 사례 : FFT와 EDM

식(8)의 푸리에 급수는 주기가 t로 고정된 함수에만 적용할 수 있다는 한계가 있다. 이를 보완하기 위해 주기를 무한대로 보내면 다음과 같은 연속형 함수로 바뀌고, 주기 t에 대해 정의한 원래의 함수 x는 연속형 주파수 f에 관한 함수 X로 바뀐다. 이러한 주파수 분해를 푸리에 변환이라고 한다.

```math
X(f) = \int_{-\infty}^{\infty} x(t)e^{-i2 \pi ft} dt
```

그런데 컴퓨터는 연속형 데이터를 그대로 처리할 수 없기 때문에 푸리에 변환을 그대로 연산할 수 없어 연속적인 주파수 변환을 균등한 간격으로 샘플링하여 다시 이산형으로 변환하는데, 이 과정에서 복소수의 켤레근 성질을 이용하여 연산량을 획기적으로 줄인 알고리즘이 고속 푸리에 변환(fast Fourier transformation, FFT)이라고 한다. 즉, FFT는 푸리에 변환의 원리를 그대로 주파수나 시계열 데이터에 적용하여 사인, 코사인 함수의 조합으로 연결시키는 분석 방법이다.

한편, 이론적으로는 완벽하지만 실제 데이터를 사인, 코사인 함수만의 조합으로 분해하는 경우 실증적으로 불일치하는 경우가 많다. 푸리에 분해의 문제는 시계열 데이터에 비정상 요인이 존재해서 주기성을 발견할 수 없는 경우에 극대화된다. 이에, 분해하는 주파수를 사인, 코사인으로 고정하지 않고 데이터 자체의 특성으로부터 데이터를 구성하는 주기 함수를 추출해내는 분석 기법이 EMD(empirical mode decomposition)이다. EMD 기법은 sifting이라는 알고리즘을 통해 주기함수의 성질을 가지는 고유 모드 함수(intrinsic mode function)를 추출한다. 

이같은 분석 방법의 성질을 고려했을 때, FFT는 주기성에 대한 이론적인 확신이 있는 데이터에 대해, EMD는 주기성에 대한 확신이 없으며 시계열 데이터에서 존재했을 가능성이 있는 일회성 충격을 분리해내기 위한 목적으로 사용할 수 있다.